# quant_project 量化选股系统问题分析与重新设计方案

**生成时间**: 2026-02-14  
**作者**: OpenClaw Agent

---

## 一、问题分析

### 1.1 当前系统功能清单

| 模块 | 功能 | 代码行数 | 问题 |
|:---|:---|:---:|:---|
| 选股 | MA20角度、RSI、MACD、BOLL、KDJ | ~1000 | 信号过多 |
| 回测 | 单股/批量回测、收益曲线、夏普比率 | ~800 | 精度不足 |
| ML预测 | LSTM/随机森林预测涨跌概率 | ~600 | 效果存疑 |
| 评分系统 | 5维度评分+信号推荐 | ~400 | 逻辑复杂 |
| 推送 | 邮件/飞书/每日报告 | ~600 | 门槛高 |
| 实时监控 | 涨跌幅/热点/板块 | ~500 | 数据不准 |
| 数据获取 | akshare在线/本地缓存 | ~400 | 不稳定 |
| 视频生成 | K线截图/幻灯片 | ~300 | 用途不明 |

### 1.2 核心问题诊断

#### 问题1: 功能堆砌，没有重点
- **现象**: 17个Python文件，每个都做不同的事
- **用户感受**: "我只是想找个能买的股票，你给我20个指标干嘛？"
- **根因**: 开发者想"全"，用户要"精"

#### 问题2: 信号太多太杂，用户不知道该信哪个
- **症状**: 
  - MA20说买，RSI说超买，MACD说死叉
  - 评分系统说75分可以买，LSTM说跌概率60%
  - 5个信号3个方向，用户原地懵圈
- **用户**: "到底听谁的？"

#### 问题3: 界面复杂，新手不会用
- **证据**: app.py 1586行，一个文件包含所有页面
- **操作流程**: 
  1. 选行业 → 2. 输代码 → 3. 调参数 → 4. 看图表 → 5. 回测 → 6. 看评分
  - 6步！用户只是想看个股票
- **对比**: 东方财富App = 3步：打开→搜索→看结论

#### 问题4: 回测结果和实际差距大
- **已知问题**:
  - 使用模拟数据演示（generate_mock_data）
  - 未考虑手续费、滑点、流动性
  - 单边行情测试，结果失真
- **后果**: 用户实盘亏钱 → 怪系统 → 卸载

### 1.3 用户使用流程分析

```
当前流程（问题流程）:
┌──────────────────────────────────────────────────────────────┐
│ 用户目标：找到可以买入的股票                                    │
├──────────────────────────────────────────────────────────────┤
│ Step 1: 打开APP                                                │
│ Step 2: 在侧边栏找到"选股"页面                                  │
│ Step 3: 选择行业（如果知道）                                     │
│ Step 4: 输入股票代码                                            │
│ Step 5: 等待加载（可能失败）                                     │
│ Step 6: 看到5个指标信号，不知道啥意思                            │
│ Step 7: 点击"评分"看分数                                        │
│ Step 8: 点击"回测"看历史                                        │
│ Step 9: 纠结要不要信                                            │
│ Step 10: 放弃 / 凭感觉买                                       │
└──────────────────────────────────────────────────────────────┘
```

**问题**: 10步得到一个不确定的结论，用户体验极差。

---

## 二、重新定位

### 2.1 系统核心价值重定义

#### 核心定位：一句话

> **"帮散户做出更理性的买入决策"**

#### 用户痛点精准定位

| 用户类型 | 痛点 | 需求 |
|:---|:---|:---|
| 新手 | 不知道啥指标、不会看K线 | **给结论，别给数据** |
| 老手 | 信号太多、不知道信哪个 | **帮我做决策，别让我自己判断** |
| 忙人 | 没时间看盘、研究 | **每天推1-3只，直接告诉我买不买** |

#### 核心价值主张

| 旧定位 | 新定位 |
|:---|:---|
| 技术指标计算器 | 股票买入决策助手 |
| 多策略回测系统 | 简单有效的选股工具 |
| 功能堆砌 | **精选功能+清晰结论** |

### 2.2 功能优先级

#### 砍掉的功能（做减法）

| 功能 | 原因 | 替代方案 |
|:---|:---|:---|
| LSTM预测 | 准确率存疑，黑箱难解释 | 删掉 |
| BOLL/KDJ | 普通人看不懂 | 删掉 |
| 批量回测 | 99%用户不用 | 删掉 |
| 视频生成 | 不知道有啥用 | 删掉 |
| 邮件推送 | 门槛高、使用率低 | 暂时搁置 |
| 多策略组合 | 太复杂，新手不会用 | 删掉 |

#### 保留的功能（做精）

| 功能 | 价值 | 改进方向 |
|:---|:---|:---|
| **MA20角度** | 简单直观，代表趋势 | 核心指标 |
| **综合评分** | 一眼看懂 | 唯一结论 |
| **RSI** | 超买超卖，经典有效 | 辅助参考 |
| **MACD** | 趋势转折，有用 | 辅助参考 |
| **回测验证** | 建立信任 | 简化+真实数据 |

#### 新增的功能（补漏）

| 功能 | 目的 |
|:---|:---|
| **今日推荐** | 每天3只，直接给结论 |
| **信号解释** | 为什么买/卖，说人话 |
| **实盘验证** | 展示系统选股的真实表现 |

---

## 三、优化方案

### 3.1 页面结构设计

```
新架构：3个页面 + 1个首页
┌─────────────────────────────────────────────────┐
│  📊 首页仪表盘                                   │
│  ├── 今日推荐（3只）                            │
│  ├── 近期表现（回测验证）                       │
│  └── 快速搜索                                   │
├─────────────────────────────────────────────────┤
│  🔍 智能选股                                    │
│  ├── 条件筛选（行业/分数/信号）                 │
│  ├── 结果列表                                   │
│  └── 单股详情页                                  │
├─────────────────────────────────────────────────┤
│  📈 单股分析                                    │
│  ├── 综合评分（大字展示）                       │
│  ├── 3大信号（MA20/RSI/MACD）                  │
│  ├── 简单解释（为什么买/卖）                   │
│  └── 一键回测                                   │
└─────────────────────────────────────────────────┘
```

### 3.2 页面详细设计

#### 页面1: 首页仪表盘（Dashboard）

```
┌─────────────────────────────────────────────────────────────────────┐
│  📊 量化选股助手                                      🔍 搜索股票 │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  🎯 今日推荐                                      📈 近期验证      │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐  ┌─────────────┐│
│  │ 600519     │ │ 000001      │ │ 300750      │  │ 过去10只推荐 ││
│  │ 贵州茅台    │ │ 平安银行    │ │ 宁德时代    │  │ 胜率: 70%    ││
│  │ 评分: 82   │ │ 评分: 75    │ │ 评分: 78    │  │ 平均收益: +5%││
│  │ 🟢 买入    │ │ 🟢 买入    │ │ 🟢 买入    │  │              ││
│  └─────────────┘ └─────────────┘ └─────────────┘  └─────────────┘│
│                                                                     │
├─────────────────────────────────────────────────────────────────────┤
│  ⚡ 快速操作                                                         │
│  [🔍 选股]  [📊 评分榜]  [📈 自选股]                                 │
└─────────────────────────────────────────────────────────────────────┘
```

**设计要点**:
- 首屏展示核心价值：今日推荐
- 近期验证建立信任
- 3个按钮覆盖90%场景

#### 页面2: 智能选股

```
┌─────────────────────────────────────────────────────────────────────┐
│  🔍 智能选股                                              [+自选股] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 行业: [全部 ▾]  分数: [≥60 ▾]  信号: [买入 ▾]   [开始选股] │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 代码    名称    评分  MA20    RSI    信号    操作           │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │ 600519  贵州茅台  82   ↑5.2°   45     🟢买入  [详情] [➕]   │   │
│  │ 000001  平安银行 75   ↑3.1°   38     🟢买入  [详情] [➕]   │   │
│  │ 300750  宁德时代 78   ↑4.5°   52     🟢买入  [详情] [➕]   │   │
│  │ ...                                                          │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  共 12 只股票  |  [上一页] 1 2 3 4 5 [下一页]                       │
└─────────────────────────────────────────────────────────────────────┘
```

**设计要点**:
- 筛选条件不超过3个
- 列表简洁，只展示关键信息
- 分页处理大量结果

#### 页面3: 单股分析（核心页面）

```
┌─────────────────────────────────────────────────────────────────────┐
│  🔍 600519 贵州茅台                                      [+自选股] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                    综合评分: 82分                            │   │
│  │                    🟢 建议：买入                              │   │
│  │               ───────────────────────────────                │   │
│  │               0    20    40    60    80    100               │   │
│  │               ├────┼────┼────┼────┼────┼────┤               │   │
│  │               ▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░                      │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌───────────────────┐ ┌───────────────────┐ ┌─────────────────┐ │
│  │ 📈 MA20趋势       │ │ 📊 RSI动量        │ │ 📉 MACD趋势    │ │
│  │ ↑ 5.2°           │ │ 45 (正常区间)      │ │ 🟢 金叉        │ │
│  │ 🟢 强势上涨      │ │ 🟢 偏多           │ │ 🟢 看涨        │ │
│  │ 得分: 85/100     │ │ 得分: 78/100      │ │ 得分: 82/100   │ │
│  └───────────────────┘ └───────────────────┘ └─────────────────┘ │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 💡 信号解释                                                    │   │
│  │ • MA20角度5.2°，表示短期趋势向上，且斜率较陡峭                 │   │
│  │ • RSI=45处于30-70正常区间，未超买，可以考虑买入                │   │
│  │ • MACD刚刚金叉，暗示上涨动能增强                              │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 📈 历史回测 (2024-01-01 ~ 2025-01-01)                       │   │
│  │ 总收益: +32.5%  |  夏普比率: 2.1  |  胜率: 75%  |  交易: 8次 │   │
│  │              ▂▃▅▇█▇▅▃▂▂▃▅▆▇█▇▅▃▂                          │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  [🔙 返回选股]  [📊 查看详情图表]  [🚀 一键模拟]                   │
└─────────────────────────────────────────────────────────────────────┘
```

**设计要点**:
- 评分+结论，首屏给结论
- 3大信号，每个都有"得分+人话解释"
- 信号解释用bullet point，普通人能看懂
- 回测数据真实、简洁

### 3.3 交互流程优化

#### 场景1: 找今天能买的股票

```
旧流程（10步）:
1. 打开APP
2. 找侧边栏
3. 点"选股"
4. 选行业
5. 输入代码
6. 等待加载
7. 看5个指标
8. 点评分
9. 点回测
10. 纠结

新流程（3步）:
1. 打开首页 → 看到"今日推荐"
2. 点股票 → 看到"建议买入"
3. 下单
```

#### 场景2: 自选股跟踪

```
旧流程:
1. 记住代码
2. 手动添加到watchlist.json
3. 每次打开app.py手动查看

新流程:
1. 搜索股票
2. 点"+自选"
3. 首页"自选股"tab直接查看
```

### 3.4 数据流程优化

```
问题数据流:
┌──────────┐    akshare     ┌──────────┐    解析      ┌──────────┐
│   akshare │ ───────────→  │  app.py  │ ──────────→ │  用户    │
│   (在线)   │   可能失败     │ (单文件)  │   20个字段   │   懵圈    │
└──────────┘                └──────────┘             └──────────┘

新数据流:
┌──────────┐    每日cron    ┌──────────┐    预处理    ┌──────────┐
│   akshare │ ───────────→  │  每日任务 │ ──────────→ │  推荐表   │
│   (离线)   │   晚8点运行    │ (缓存器)  │   只保留3指标 │   (首页)  │
└──────────┘                └──────────┘             └──────────┘
```

**改进**:
- 数据预计算，每日收盘后批量处理
- 缓存到数据库/文件
- 首页直接读取缓存，秒开

---

## 四、实现优先级

### 阶段1: MVP - 最小可用产品（2周）

| 优先级 | 功能 | 预计工时 | 说明 |
|:---|:---|:---:|:---|
| P0 | 首页今日推荐 | 2天 | 每日3只，核心价值 |
| P0 | 单股详情页 | 2天 | 评分+3指标+解释 |
| P0 | 搜索+自选 | 1天 | 基础功能 |
| P1 | 评分系统优化 | 2天 | 统一评分逻辑 |
| P1 | 数据缓存层 | 1天 | 每日cron预计算 |
| P2 | 简单回测 | 1天 | 只保留收益曲线 |

**MVP交付物**: 用户打开首页 → 看到今日推荐 → 点一只 → 看到"买入建议+解释" → 完成

### 阶段2: 核心功能完善（2周）

| 优先级 | 功能 | 预计工时 | 说明 |
|:---|:---|:---:|:---|
| P0 | 选股列表页 | 2天 | 条件筛选+分页 |
| P1 | 回测验证展示 | 2天 | 展示系统历史表现 |
| P1 | 信号解释优化 | 2天 | 更通俗易懂 |
| P1 | 数据稳定性 | 2天 | 离线缓存+重试 |
| P2 | 移动端适配 | 1天 | 响应式设计 |

### 阶段3: 高级功能（按需）

| 功能 | 预计工时 | 说明 |
|:---|:---:|:---|
| 飞书推送 | 3天 | 付费功能 |
| 模拟交易 | 3天 | 练习功能 |
| 组合回测 | 3天 | 高级功能 |
| 社区分享 | 5天 | 长期功能 |

---

## 五、技术架构调整

### 5.1 代码结构优化

```
当前问题:
app.py (1586行，所有功能混在一起)

优化后:
├── pages/                    # Streamlit页面
│   ├── 1_Dashboard.py        # 首页（今日推荐）
│   ├── 2_Screener.py          # 选股列表
│   └── 3_StockDetail.py      # 单股分析
├── components/               # 可复用组件
│   ├── ScoreCard.py          # 评分卡片
│   ├── SignalIndicator.py    # 信号指示器
│   └── StockChart.py         # 图表组件
├── services/                 # 业务逻辑
│   ├── scorer.py             # 评分服务
│   ├── recommender.py        # 推荐服务
│   ├── data_fetcher.py      # 数据获取
│   └── cache_manager.py      # 缓存管理
├── data/                     # 数据存储
│   ├── daily_recommend.json  # 每日推荐缓存
│   └── stock_cache.h5        # 股票数据缓存
├── app.py                    # 主入口（只放导航）
└── requirements.txt
```

### 5.2 数据流程优化

```python
# 每日cron任务（晚8点运行）
def daily_job():
    # 1. 获取全部A股数据（离线）
    stocks = fetch_all_stocks()
    
    # 2. 计算评分（预计算）
    for stock in stocks:
        score = calculate_score(stock)
    
    # 3. 生成推荐列表（Top 10）
    recommend = get_top_by_score(stocks, n=10)
    
    # 4. 缓存到文件
    save_daily_recommend(recommend)

# 首页直接读取缓存
def show_dashboard():
    recommend = load_daily_recommend()
    if recommend:
        show_recommend_card(recommend)  # 秒开
    else:
        show_loading("数据更新中...")
```

---

## 六、成功指标

### 6.1 用户体验指标

| 指标 | 现状 | 目标 |
|:---|:---:|:---|
| 首页到推荐耗时 | 10秒+ | <1秒 |
| 完成购买决策时间 | 10分钟 | 2分钟 |
| 新手理解率 | 20% | 80% |

### 6.2 业务指标

| 指标 | 目标 |
|:---|:---|
| 每日UV | 100→1000 |
| 留存率（7日） | 10%→30% |
| 推荐点击率 | 50% |

---

## 七、风险与应对

| 风险 | 概率 | 影响 | 应对 |
|:---|:---:|:---:|:---|
| 数据源不稳定 | 中 | 高 | 多数据源+本地缓存 |
| 评分准确率低 | 高 | 高 | 回测验证+透明展示 |
| 用户看不懂 | 中 | 中 | 持续优化解释文案 |

---

## 八、总结

### 核心改变

| 维度 | 旧 | 新 |
|:---|:---|:---|
| 定位 | 技术指标工具 | 买入决策助手 |
| 功能 | 多而杂 | 少而精 |
| 流程 | 用户自己判断 | 系统给结论 |
| 体验 | 复杂难用 | 简单直接 |

### 下一步行动

1. **本周**: 确认方案，启动MVP开发
2. **第1周**: 完成首页+单股详情
3. **第2周**: 完成选股列表+数据优化
4. **第3周**: 测试+修复Bug
5. **第4周**: 正式发布+收集反馈

---

*报告完成时间: 2026-02-14*
